<div>
<h2>&#30446;&#24405;</h2>
<div>
<ul>
<li><a href="http://www.zmonster.me#orgheadline1" rel="noopener noreferrer" target="_blank">&#38382;&#39064;</a></li>
<li><a href="http://www.zmonster.me#orgheadline2" rel="noopener noreferrer" target="_blank">&#21152;&#38145;</a></li>
<li><a href="http://www.zmonster.me#orgheadline3" rel="noopener noreferrer" target="_blank">&#21462;&#28040;&#32534;&#35793;&#22120;&#20248;&#21270;</a></li>
<li><a href="http://www.zmonster.me#orgheadline4" rel="noopener noreferrer" target="_blank">&#23616;&#37096;&#21464;&#37327;&#65292;&#24490;&#29615;&#21464;&#37327;</a></li>
</ul>
</div>
</div>

<div>
<h2>&#38382;&#39064;</h2>
<div>
<p>
&#22312;&#27979;&#35797;&#33258;&#24049;&#20889;&#30340;&#19968;&#20010;&#20351;&#29992;&#20102;&#22810;&#32447;&#31243;&#30340;API&#26102;&#65292;&#25105;&#21457;&#29616;&#26377;&#26102;&#20505;&#20250;&#20986;&#29616;&#19968;&#20123;&#39044;&#26399;&#20043;&#22806;&#30340;&#32467;&#26524;&#12290;
</p>

<p>
&#39318;&#20808;&#65292;&#36825;&#20010;API&#30340;&#23454;&#29616;&#20013;&#28041;&#21450;&#22810;&#32447;&#31243;&#30340;&#37096;&#20998;&#22823;&#33268;&#26159;&#36825;&#26679;&#30340;&#65306;
</p>
<ol>
<li><p>
&#26377;&#19968;&#20010;&#20840;&#23616;&#21021;&#22987;&#21270;&#20989;&#25968;&#65292;&#24490;&#29615;&#21019;&#24314;&#22810;&#20010;&#32447;&#31243;&#65292;&#24182;&#23558;&#27599;&#20010;&#32447;&#31243;&#21644;&#19968;&#20010;&#32447;&#31243;&#21495;&#32465;&#23450;(&#22312;pthread_create&#20013;&#20316;&#20026;&#31532;&#22235;&#20010;&#21442;&#25968;&#20256;&#20837;)
</p>

<div>

<pre><span>int</span> <span>Init</span>(<span>int</span> <span>thread_num</span>) {
    <span>int</span> <span>ret</span> = 0;

    <span>pthread_t</span> *<span>thread_list</span> = (<span>pthread_t</span> *)calloc(thread_num, <span>sizeof</span>(pthread_t));

    <span>pthread_attr_t</span> <span>a</span>;
    pthread_attr_init(&amp;a);
    pthread_attr_setdetachstate(&amp;a, PTHREAD_CREATE_DETACHED);

    <span>for</span> (<span>int</span> <span>i</span> = 0; i &lt; thread_num; ++i) {
        ret = pthread_create(thread_list + i, &amp;a, thread_func, (<span>void</span> *)&amp;i);

        <span>if</span>(ret != 0) {
            <span>return</span> ret;
        }
    }

    <span>return</span> ret;
}
</pre>
</div></li>
<li><p>
&#19981;&#21516;&#30340;&#32447;&#31243;&#26681;&#25454;&#32465;&#23450;&#30340;&#32447;&#31243;&#21495;&#19981;&#26029;&#26597;&#30475;&#19968;&#20010;&#20840;&#23616;&#21464;&#37327;&#25968;&#32452;&#20013;&#23545;&#24212;&#30340;&#34920;&#31034;&#20219;&#21153;&#29366;&#24577;&#30340;&#20803;&#32032;&#65292;&#24403;&#26816;&#27979;&#21040;&#29366;&#24577;&#20026; <b>READY</b> &#26102;&#23601;&#25191;&#34892;&#19968;&#20123;&#20219;&#21153;
</p>

<div>

<pre><span>struct</span> <span>Task</span>{
    <span>int</span> <span>status</span>;
    <span>// </span><span>other</span>
};

<span>Task</span> <span>tasks</span>[MAX_TASK_NUM];

<span>void</span> *<span>thread_func</span>(<span>void</span> *<span>thread_id</span>)
{
    <span>int</span> <span>i</span> = *((<span>int</span> *)thread_id);

    <span>int</span> <span>status</span> = 0;

    <span>do</span> {
        status = tasks[i].status;
        <span>if</span> (status == READY) {

            <span>// </span><span>do something</span>

            tasks[i].status = DONE;
        }
        <span>else</span> {
            sleep(1);
        }
    }<span>while</span> (status != QUIT);
}
</pre>
</div></li>
<li><p>
&#19968;&#20010;&#27169;&#22359;&#21021;&#22987;&#21270;&#20989;&#25968;&#65292;&#29992;&#26469;&#21021;&#22987;&#21270;&#22788;&#29702;&#27169;&#22359;&#65292;&#36825;&#20010;&#22788;&#29702;&#27169;&#22359;&#20250;&#20570;&#19968;&#20123;&#39044;&#22788;&#29702;&#65292;&#28982;&#21518;&#36890;&#36807;&#32447;&#31243;&#26469;&#36827;&#34892;&#26368;&#21518;&#30340;&#25805;&#20316;&#65292;&#36825;&#20010;&#21021;&#22987;&#21270;&#20989;&#25968;&#25509;&#21463;&#19968;&#20010;&#32447;&#31243;&#21495;&#20316;&#20026;&#21442;&#25968;
</p>

<div>

<pre><span>struct</span> <span>Env</span>{
    <span>int</span> <span>thread_id</span>;
    <span>// </span><span>other</span>
};

<span>void</span> <span>Prepare</span>(<span>Env</span> *<span>env</span>, <span>int</span> <span>thread_id</span>)
{
    env-&gt;thread_id = thread_id;
    <span>// </span><span>other</span>
}
</pre>
</div></li>
<li><p>
&#19968;&#20010;&#27169;&#22359;&#22788;&#29702;&#20989;&#25968;&#65292;&#22312;&#21021;&#22987;&#21270;&#19968;&#20123;&#29615;&#22659;&#12289;&#36827;&#34892;&#19968;&#20123;&#39044;&#22788;&#29702;&#21518;&#65292;&#23558;&#23545;&#24212;&#32447;&#31243;&#30340;&#29366;&#24577;&#32622;&#20026; <b>READY</b> &#65292;&#28982;&#21518;&#31561;&#24453;&#30452;&#21040;&#23545;&#24212;&#32447;&#31243;&#22788;&#29702;&#23436;&#27605;
</p>

<div>

<pre><span>void</span> <span>Run</span>(<span>Env</span> *<span>env</span>)
{
    <span>// </span><span>do preprocessing</span>
    <span>int</span> <span>i</span> = env-&gt;thread_id;
    tasks[i].status = READY;

    <span>int</span> <span>status</span>;
    <span>do</span> {
        sleep(1);
        status = tasks[i].status;
    } <span>while</span> (status != DONE);
}
</pre>
</div></li>
</ol>


<p>
&#25105;&#36935;&#21040;&#30340;&#38382;&#39064;&#23601;&#26159;&#65292;&#22312;&#23558;&#31532; <b>i</b> &#20010;&#32447;&#31243;&#23545;&#24212;&#30340;&#29366;&#24577;&#32622;&#20026; <b>READY</b> &#21518;&#65292;&#32447;&#31243;&#20989;&#25968;&#24182;&#27809;&#26377;&#36827;&#34892;&#30456;&#24212;&#30340;&#25805;&#20316;(&#20598;&#23572;)&#12290;
</p>
</div>
</div>

<div>
<h2>&#21152;&#38145;</h2>
<div>
<p>
&#19968;&#24320;&#22987;&#65292;&#25105;&#24182;&#27809;&#26377;&#23545;&#20840;&#23616;&#21464;&#37327;&#30340;&#35835;&#20889;&#36827;&#34892;&#21152;&#38145;&#65292;&#22240;&#27492;&#24576;&#30097;&#26159;&#22788;&#29702;&#20989;&#25968;&#20013;&#23545;&#29366;&#24577;&#25104;&#21592;&#21464;&#37327;&#30340;&#20462;&#25913;&#27809;&#26377;&#25104;&#21151;&#12290;&#20110;&#26159;&#25105;&#23558;&#25152;&#26377;&#23545;&#20840;&#23616;&#21464;&#37327;&#25968;&#32452;&#20013;&#29366;&#24577;&#25104;&#21592;&#30340;&#35835;&#20889;&#25805;&#20316;&#37117;&#21152;&#20102;&#38145;&#65292;&#20294;&#26159;&#38382;&#39064;&#20173;&#28982;&#23384;&#22312;&#12290;
</p>
</div>
</div>

<div>
<h2>&#21462;&#28040;&#32534;&#35793;&#22120;&#20248;&#21270;</h2>
<div>
<p>
&#32771;&#34385;&#21040;&#23545;&#20840;&#23616;&#25968;&#32452;&#30340;&#29366;&#24577;&#25104;&#21592;&#30340;&#35835;&#12289;&#20889;&#25805;&#20316;&#26377;&#37096;&#20998;&#26159;&#22312;&#24490;&#29615;&#20013;&#36827;&#34892;&#30340;&#65292;&#22240;&#27492;&#24576;&#30097;gcc&#22312;&#32534;&#35793;&#22120;&#26102;&#23545;&#31243;&#24207;&#36827;&#34892;&#20102;&#20248;&#21270;&#65292;&#20110;&#26159;&#29992; <b>volatile</b> &#20462;&#39280;&#20102;&#29366;&#24577;&#25104;&#21592;
</p>
<div>

<pre><span>struct</span> <span>Task</span>{
    <span>volatile</span> <span>int</span> <span>status</span>;
    <span>// </span><span>other</span>
};
</pre>
</div>

<p>
&#28982;&#32780;&#36825;&#20010;&#26041;&#27861;&#20173;&#28982;&#26080;&#25928;&#12290;
</p>
</div>
</div>

<div>
<h2>&#23616;&#37096;&#21464;&#37327;&#65292;&#24490;&#29615;&#21464;&#37327;</h2>
<div>
<p>
&#21644;&#39033;&#30446;&#32452;&#32452;&#38271;&#35752;&#35770;&#21518;&#65292;&#20182;&#20063;&#34920;&#31034;&#26242;&#26102;&#27809;&#21457;&#29616;&#36825;&#20010;&#38382;&#39064;&#30340;&#26681;&#28304;&#65292;&#19981;&#36807;&#20182;&#24314;&#35758;&#25105;&#23558; <b>&#32447;&#31243;&#20989;&#25968;</b> &#35775;&#38382;&#30340; <b>&#20840;&#23616;&#25968;&#32452;&#20803;&#32032;&#30340;&#22320;&#22336;</b> &#19982; <b>&#22788;&#29702;&#20989;&#25968;</b> &#20013;&#35775;&#38382;&#30340; <b>&#20840;&#23616;&#25968;&#32452;&#20803;&#32032;&#30340;&#22320;&#22336;</b> &#25171;&#21360;&#20986;&#26469;&#23545;&#27604;&#19968;&#19979;&#12290;&#25105;&#21548;&#20174;&#20102;&#32452;&#38271;&#30340;&#24314;&#35758;&#65292;&#36825;&#26679;&#20570;&#20102;&#65292;&#28982;&#21518;&#26524;&#28982;&#21457;&#29616;&#20102;&#38382;&#39064;&#12290;
</p>

<p>
&#22312;&#20986;&#38169;&#26102;&#65292;&#36825;&#20004;&#20010;&#22320;&#22336;&#26159;&#19981;&#19968;&#26679;&#30340;&#12290;&#38543;&#21518;&#65292;&#25105;&#23558; <b>thread_func</b> &#20989;&#25968;&#19982; <b>Run</b> &#20989;&#25968;&#20013;&#30340;&#21464;&#37327; <b>i</b> &#30340;&#20540;&#25171;&#21360;&#20986;&#26469;&#65292;&#21457;&#29616;&#22312;&#20986;&#38169;&#30340;&#24773;&#20917;&#19979;&#65292;&#36825;&#20004;&#20010;&#20540;&#19981;&#30456;&#31561;&#12290;&#38745;&#19979;&#24515;&#26469;&#24605;&#32771;&#20102;&#19968;&#20250;&#21518;&#65292;&#25105;&#21457;&#29616;&#20102;&#38382;&#39064;&#30340;&#26681;&#28304;&#25152;&#22312;&#65292;&#21363;&#20840;&#23616;&#21021;&#22987;&#21270;&#20989;&#25968; <b>Init</b> &#20013;&#21019;&#24314;&#32447;&#31243;&#36825;&#19968;&#27573;:
</p>
<div>

<pre><span>for</span> (<span>int</span> <span>i</span> = 0; i &lt; thread_num; ++i) {
    ret = pthread_create(thread_list + i, &amp;a, thread_func, (<span>void</span> *)&amp;i);

    <span>if</span>(ret != 0) {
        <span>return</span> ret;
    }
}
</pre>
</div>
<p>
<b>pthread_create</b> &#20989;&#25968;&#25509;&#21463;&#30340;&#31532;&#22235;&#20010;&#21442;&#25968;&#26159;&#20316;&#20026;&#32447;&#31243;&#20989;&#25968; <b>thread_func</b> &#30340;&#21442;&#25968;&#30340;&#65292;&#32780;&#22312;&#36825;&#37324;&#65292;&#25105;&#23558;&#26082;&#26159; <b>&#23616;&#37096;&#21464;&#37327;</b> &#20063;&#26159; <b>&#24490;&#29615;&#21464;&#37327;</b> &#30340; <b>i</b> &#30340; <b>&#22320;&#22336;&#20540;</b> &#20316;&#20026; <b>pthread_create</b> &#20989;&#25968;&#30340;&#31532;&#22235;&#20010;&#21442;&#25968;&#12290;
</p>

<p>
&#22312;&#27979;&#35797;&#26102;&#65292;&#20026;&#20102;&#26041;&#20415;&#65292;&#22312;&#25191;&#34892; <b>Init</b> &#20989;&#25968;&#26102;&#65292;&#25105;&#21482;&#35753;&#23427;&#21019;&#24314;&#20102;&#19968;&#20010;&#32447;&#31243;&#65292;&#21363;&#23545;&#20989;&#25968;&#65306;
</p>
<div>

<pre><span>int</span> <span>Init</span>(<span>int</span> <span>thread_num</span>);
</pre>
</div>
<p>
&#20256;&#20837;&#30340; <b>thread_num</b> &#21442;&#25968;&#30340;&#20540;&#20026; <b>1</b> &#12290;
</p>

<p>
&#39318;&#20808;&#65292;&#20316;&#20026;&#24490;&#29615;&#21464;&#37327;&#65292; <b>Init</b> &#20013;&#30340;&#21464;&#37327; <b>i</b> &#22312;&#24490;&#29615;&#32467;&#26463;&#26102;&#20540;&#20026; <b>1</b> &#65292;&#32780;&#22312; <b>Run</b> &#20989;&#25968;&#20013;&#65292;&#34920;&#31034;&#32447;&#31243;&#21495;&#30340;&#21464;&#37327; <b>i</b> &#30340;&#20540;&#21017;&#20026; <b>0</b> &#12290;
</p>

<p>
&#20854;&#27425;&#65292;&#20027;&#32447;&#31243;&#19982;&#23376;&#32447;&#31243;&#20043;&#38388;&#36816;&#34892;&#30340;&#20808;&#21518;&#27425;&#24207;&#26159;&#19981;&#30830;&#23450;&#30340;&#12290;
</p>

<p>
&#26368;&#21518;&#65292; <b>Init</b> &#20989;&#25968;&#20013;&#30340;&#21464;&#37327; <b>i</b> &#26159;&#23616;&#37096;&#21464;&#37327;&#65292;&#22312; <b>Init</b> &#20989;&#25968;&#25191;&#34892;&#23436;&#21518;&#65292;&#20854;&#23545;&#24212;&#22320;&#22336;&#30340;&#20540;&#26159;&#19981;&#33021;&#20445;&#35777;&#30340;&#12290;
</p>

<p>
&#24635;&#20043;&#36825;&#26679;&#30340;&#20570;&#27861;&#26159;&#22823;&#38169;&#29305;&#38169;&#30340;&#12290;&#22312;&#25105;&#23558;&#19978;&#36848;&#24490;&#29615;&#21019;&#24314;&#32447;&#31243;&#30340;&#20195;&#30721;&#27573;&#20462;&#25913;&#20026;&#22914;&#19979;&#20869;&#23481;&#21518;&#65292;&#26412;&#25991;&#25152;&#36848;&#30340;&#38382;&#39064;&#24471;&#21040;&#20102;&#24443;&#24213;&#30340;&#35299;&#20915;&#65306;
</p>
<div>

<pre><span>for</span> (<span>int</span> <span>i</span> = 0; i &lt; thread_num; ++i) {
    tasks[i].thread_id = i;
    ret = pthread_create(thread_list + i, &amp;a, thread_func, (<span>void</span> *)&amp;(tasks[i].thread_id));

    <span>if</span>(ret != 0) {
        <span>return</span> ret;
    }
}
</pre>
</div>
<p>
&#27880;&#24847;&#65292;&#36825;&#37324;&#30340; <b>thread_id</b> &#26159;&#22312; <b>Task</b> &#32467;&#26500;&#20013;&#26032;&#28155;&#21152;&#30340; <b>int</b> &#31867;&#22411;&#25104;&#21592;
</p>
</div>
</div>